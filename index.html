<!DOCTYPE html>
<html>
	<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
		<link rel="stylesheet" href="css/leaflet.css" />
		<link rel="stylesheet" href="css/mycss.css" />
    <link rel="stylesheet" href="css/bootstrap.css" />
		<script src="js/leaflet.js"></script>
    <script src="js/bootstrap.js"></script>
	</head>
	<body>
		<div class="container-fluid" >
			<div class="row" style="margin-top: 05px;padding-top: 5px;padding-bottom: 5px;margin-bottom: 5px;">
				<div class="col-sm-8" id="menu">
					<input id="file-input" size="20" type="file"></div>
				<div class="col-sm-2 text-end" id="latLang" style="padding-right: 0px;"></div>
				<div class="col-sm-2 text-center" id="tituloInfo" style="padding-right: 0px;"></div>
			</div>
			<div class="row" style="height: 90vh;margin-left: 0px;"">
				<div class="col-sm-10" id="map" ></div>
				<div class="col-sm-2" id="info"></div>	
			</div>
		</div>
		<script>
		    var nombre='';
		    var xml = new XMLHttpRequest();
			var map = L.map('map').setView([41.125, 1.238], 13);
			L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 18,
			    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
	      
	      	//L.control.scale(metric).addTo(map)
	      	
	      	/*
	      	// Poner un marcador en el mapa
	      	L.marker([41.124302580367235, 1.2385328405983511]).addTo(map)
				    .bindPopup('Hospital Universitario Joan XXIII.')
				    .openPopup();
			*/

			map.on('click', onMapClick);

			function onMapClick(e) {
			    //alert("Has clicado en la posicion " + e.latlng);
			    document.getElementById("latLang").innerHTML='<h5>'+e.latlng+'</h5>';
			}

	        function leerArchivo(e) {
		        var archivo = e.target.files[0];
		        if (!archivo) {
		          return;
		        }
		        nombre=archivo.name;
		        nombre = "tracks/"+nombre;
		        loadDoc(nombre);
		    }

		    document.getElementById('file-input')
		      .addEventListener('change', leerArchivo, false);

		    function loadDoc(nombre){
	      		xml.open("GET", nombre, false);
		      	xml.send();
		    
			  	var xmlDoc = xml.responseXML;
			  	var x=xmlDoc.getElementsByTagName("desc");	  	
			  	var info =''; 

			  	for(i=0;i<x.length;i++){
			  		info += x[i].childNodes[0].nodeValue;
			  	}
				const descArray = info.split("<br />");
				var titulo = descArray[1].replace(/h3/g,'h5')
			  	document.getElementById('tituloInfo').innerHTML=titulo;
				document.getElementById('info').innerHTML=descArray[0]+'<FONT SIZE=2>'+descArray[2]+'</font>';
console.log(descArray[0]);
console.log(descArray[1]);
console.log(descArray[2]);
			  	var x=xmlDoc.getElementsByTagName("trkpt");
		    	var latlang = [];
			  	for (i=0;i<x.length;i++)
				  {     
				    var arraytemp = [x[i].attributes['lat'].value, x[i].attributes['lon'].value]
				    latlang.push(arraytemp);
				  }

			  	clearMap();
				var polyLineOptions = {color:'red'};
	        	var polyLine = L.polyline(latlang , polyLineOptions);
	        	polyLine.addTo(map);
		    }

		    function clearMap() {
			    for(i in map._layers) {
			        if(map._layers[i]._path != undefined) {
			            try {
			                map.removeLayer(map._layers[i]);
			            }
			            catch(e) {
			                console.log("problem with " + e + map._layers[i]);
			            }
			        }
			    }
			}	
		</script>
	</body>
</html>